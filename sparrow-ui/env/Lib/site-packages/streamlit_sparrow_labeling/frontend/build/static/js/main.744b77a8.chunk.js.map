{"version":3,"sources":["components/CanvasToolbar.module.css","img/undo.png","img/bin.png","components/CanvasToolbar.tsx","components/UpdateStreamlit.tsx","DrawableCanvasState.tsx","lib/fabrictool.ts","lib/index.ts","lib/circle.ts","lib/freedraw.ts","lib/line.ts","lib/polygon.ts","lib/rect.ts","lib/transform.ts","lib/point.ts","DrawableCanvas.tsx","index.tsx"],"names":["module","exports","SquareIcon","imgUrl","altText","invertX","size","enabled","clickCallback","src","className","styles","disabled","invertx","alt","title","height","width","onClick","defaultProps","CanvasToolbar","topPosition","canUndo","leftPosition","canRedo","undoCallback","downloadCallback","redoCallback","resetCallback","iconElements","undo","bin","style","position","top","left","display","gap","zIndex","map","e","key","UpdateStreamlit","props","useState","fabric","Canvas","stCanvas","setStCanvas","debouncedStateToSend","value","delay","debouncedValue","setDebouncedValue","useEffect","handler","setTimeout","clearTimeout","useDebounce","stateToSendToStreamlit","stC","enableRetinaScaling","shouldSendToStreamlit","loadFromJSON","canvas","selectedRect","data","getContext","toDataURL","Streamlit","setComponentValue","getWidth","getHeight","raw","toObject","selectIndex","sendDataToStreamlit","id","canvasWidth","canvasHeight","NO_ACTION","shouldReloadCanvas","forceSendToStreamlit","RELOAD_CANVAS","SEND_TO_STREAMLIT","RELOAD_AND_SEND_TO_STREAMLIT","canvasStateReducer","state","action","type","isEmpty","currentState","history","undoStack","redoStack","initialState","isEqual","undoOverHistoryMaxCount","length","slice","Error","isUndoEmpty","CanvasStateContext","createContext","CanvasStateProvider","children","useReducer","canvasState","dispatch","saveState","useCallback","redo","forceStreamlitUpdate","resetState","Provider","FabricTool","_canvas","this","tools","circle","isMouseDown","fillColor","strokeWidth","strokeColor","currentCircle","Circle","currentStartX","currentStartY","_minRadius","linearDistance","point1","point2","xs","x","ys","y","Math","sqrt","isDrawingMode","selection","forEachObject","o","selectable","evented","on","onMouseDown","onMouseMove","onMouseUp","onMouseOut","off","_clicked","pointer","getPointer","originX","originY","stroke","fill","radius","add","_radius","set","max","angle","atan2","PI","setCoords","renderAll","freedraw","freeDrawingBrush","color","line","currentLine","Line","points","x2","y2","remove","polygon","startCircle","currentPath","Path","_pathString","onMouseDoubleClick","_start","i","_last_pt_idx","lastIndexOf","rect","currentRect","Rect","_minLength","transparentCorners","strokeUniform","noScaleCache","abs","_width","_height","transform","args","handleDoubleClick","getActiveObject","point","displayRadius","withStreamlitConnection","backgroundColor","backgroundImageURL","realtimeUpdateStreamlit","drawingMode","initialDrawing","displayToolbar","setCanvas","stopContextMenu","fireRightClick","setSelectedRect","StaticCanvas","backgroundCanvas","setBackgroundCanvas","useContext","c","imgC","setFrameHeight","bgImage","Image","onload","drawImage","baseUrl","URLSearchParams","window","location","search","get","cleanupToolEvents","configureCanvas","toJSON","options","target","selectObject","getObjects","indexOf","selectionBackgroundColor","visibility","border","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.744b77a8.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"enabled\":\"CanvasToolbar_enabled__2bOtL\",\"disabled\":\"CanvasToolbar_disabled__T9sX8\",\"invertx\":\"CanvasToolbar_invertx__2gc2O\"};","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAwwAAAMMBnc7+MwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAEFSURBVEiJ7dSxLkRBFMbx31BIlkQlHoCap5BQLAXvQafV6DyLRLYSdkWv0dBQ0NAKkUhkj2bEzc3udW9xE5E9yVfNd85/5pyZSRGhzZhqtfoE8DcAKaVOqwD0mkBSSnNNAAmBAboR8V4qtoguVrNWMI9n3Gad4SQqHlRk9dHJvmns4qWwXqUrbESEspSMfazhekyhN9zhc8z6KWarAKN0jm0sI+WkmdyuPTyV/JdFSBXgATujjl3aYQf7+CjkXhTaPRYw+DbVETZLkMM6Leo3hGxhmHNfsVBnBk0hx4XcozqARpA8/GG+bQcJ6+rFTUQ81jGmlJYi4p6fa9da/IPvegL4Lb4A0uc9nRaYXwcAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAhQAAAIUB4uz/wQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAHUSURBVEiJtda9ahRRFAfw3xHFJCabFEkawcYiYKMWVmohBHwFOwsfQLCxthOENHZqKxZG8DHSxcJC0Qcw7AqSNSoGci3mznp3nP0K8cBlZs7X/5z//RopJeMGlrGL1Bi7WJ4Uf9pk2cQVPMDPrJvHVra9GRc8BBARS7iKU4X6cn5+wvf8vljbIuJr4XuEdyml/YGmoGIdX/xLxayji/U2iu5iJXfwa1zbY2QOOznXE4YpuoE93D5m8lr2cLMN4BWu4TF+4HDGxIEOeng90DaW5BkVj/fyd6dhP4u5hq6Tnxdz7GZpL1eLlNIhvmEtq7Yj4mHhsoWng5Ir23b+rGO6Zc62fdAtnFewUdjOqyaylo3sMxJgqIMsvcJ5X8XrKFlCvwHQmwRQdjArwH5K6fc0AKvHAFjVoGcUwCwUdbKPHNNrOpw0RVN10MVCRCz8T4A6oI/FiIiTBKh5XFN1EDnRkETEnGrnH2sOSoC60rbqoR8R8zg3bQe102oB0DYPAwB/l/VkgJTSgeo+KDtoA6h1fSN2Me1nUV3JOj7iOT5k/csi5jNe4D2uj+og8lE7rIx4hjt4hIMRRZRyX7UYLqWUjoYsI35VLuCt6tKZ5h7ewa22XH8AgjMTispa6ucAAAAASUVORK5CYII=\"","import React from \"react\"\n\nimport styles from \"./CanvasToolbar.module.css\"\n\nimport bin from \"../img/bin.png\"\nimport undo from \"../img/undo.png\"\n// import download from \"../img/download.png\"\n\ninterface SquareIconProps {\n  imgUrl: string\n  altText: string\n  invertX?: boolean\n  size: number\n  enabled: boolean\n  clickCallback: () => void\n}\n\nconst SquareIcon = ({\n  imgUrl,\n  altText,\n  invertX,\n  size,\n  enabled,\n  clickCallback,\n}: SquareIconProps) => (\n  <img\n    src={imgUrl}\n    className={`\n    ${enabled ? styles.enabled : styles.disabled} ${\n      invertX ? \"\" : styles.invertx\n    }\n    `}\n    alt={altText}\n    title={altText}\n    height={`${size}px`}\n    width={`${size}px`}\n    onClick={clickCallback}\n  />\n)\nSquareIcon.defaultProps = {\n  invertX: false,\n}\n\ninterface CanvasToolbarProps {\n  topPosition: number\n  leftPosition: number\n  canUndo: boolean\n  canRedo: boolean\n  downloadCallback: () => void\n  undoCallback: () => void\n  redoCallback: () => void\n  resetCallback: () => void\n}\n\nconst CanvasToolbar = ({\n  topPosition,\n  leftPosition,\n  canUndo,\n  canRedo,\n  downloadCallback,\n  undoCallback,\n  redoCallback,\n  resetCallback,\n}: CanvasToolbarProps) => {\n  const GAP_BETWEEN_ICONS = 4\n  const ICON_SIZE = 24\n\n  const iconElements = [\n    // {\n    //   imgUrl: download,\n    //   altText: \"Send to Streamlit\",\n    //   invertX: false,\n    //   enabled: true,\n    //   clickCallback: downloadCallback,\n    // },\n    {\n      imgUrl: undo,\n      altText: \"Undo\",\n      invertX: true,\n      enabled: canUndo,\n      clickCallback: canUndo ? undoCallback : () => {},\n    },\n    {\n      imgUrl: undo,\n      altText: \"Redo\",\n      invertX: false,\n      enabled: canRedo,\n      clickCallback: canRedo ? redoCallback : () => {},\n    },\n    {\n      imgUrl: bin,\n      altText: \"Reset canvas & history\",\n      invertX: false,\n      enabled: true,\n      clickCallback: resetCallback,\n    },\n  ]\n\n  return (\n    <div\n      style={{\n        position: \"absolute\",\n        top: topPosition + 4,\n        left: 0,\n        display: \"flex\",\n        gap: GAP_BETWEEN_ICONS,\n        zIndex: 20,\n      }}\n    >\n      {iconElements.map((e) => (\n        <SquareIcon\n          key={e.altText}\n          imgUrl={e.imgUrl}\n          altText={e.altText}\n          invertX={e.invertX}\n          size={ICON_SIZE}\n          enabled={e.enabled}\n          clickCallback={e.clickCallback}\n        />\n      ))}\n    </div>\n  )\n}\n\nexport default CanvasToolbar\n","import React, { useEffect, useState } from \"react\"\nimport { Streamlit } from \"streamlit-component-lib\"\nimport { fabric } from \"fabric\"\n\nconst DELAY_DEBOUNCE = 0\n\n/**\n * Download image and JSON data from canvas to send back to Streamlit\n */\nconst sendDataToStreamlit = (canvas: fabric.Canvas, selectedRect: number): void => {\n  const data = canvas\n    .getContext()\n    .canvas.toDataURL()\n  Streamlit.setComponentValue({\n    data: data,\n    width: canvas.getWidth(),\n    height: canvas.getHeight(),\n    raw: canvas.toObject(),\n    selectIndex: selectedRect\n  })\n}\n\n/**\n * This hook allows you to debounce any fast changing value.\n * The debounced value will only reflect the latest value when the useDebounce hook has not been called for the specified time period.\n * When used in conjunction with useEffect, you can easily ensure that expensive operations like API calls are not executed too frequently.\n * https://usehooks.com/useDebounce/\n * @param value value to debounce\n * @param delay delay of debounce in ms\n */\nconst useDebounce = (value: any, delay: number) => {\n  const [debouncedValue, setDebouncedValue] = useState(value)\n\n  useEffect(\n    () => {\n      // Update debounced value after delay\n      const handler = setTimeout(() => {\n        setDebouncedValue(value)\n      }, delay)\n\n      // Cancel the timeout if value changes (also on delay change or unmount)\n      // This is how we prevent debounced value from updating if value is changed ...\n      // .. within the delay period. Timeout gets cleared and restarted.\n      return () => {\n        clearTimeout(handler)\n      }\n    },\n    [value, delay] // Only re-call effect if value or delay changes\n  )\n  return debouncedValue\n}\n\ninterface UpdateStreamlitProps {\n  shouldSendToStreamlit: boolean\n  stateToSendToStreamlit: Object\n  canvasWidth: number\n  canvasHeight: number\n  selectedRect: number\n}\n\n/**\n * Canvas whose sole purpose is to draw current state\n * to send image data to Streamlit.\n * Put it in the background or make it invisible!\n */\nconst UpdateStreamlit = (props: UpdateStreamlitProps) => {\n  const [stCanvas, setStCanvas] = useState(new fabric.Canvas(\"\"))\n\n  // Debounce fast changing canvas states\n  // Especially when drawing lines and circles which continuously render while drawing\n  const debouncedStateToSend = useDebounce(\n    props.stateToSendToStreamlit,\n    DELAY_DEBOUNCE\n  )\n\n  // Initialize canvas\n  useEffect(() => {\n    const stC = new fabric.Canvas(\"canvas-to-streamlit\", {\n      enableRetinaScaling: false,\n    })\n    setStCanvas(stC)\n  }, [])\n\n  // Load state to canvas, then send content to Streamlit\n  useEffect(() => {\n    if (debouncedStateToSend && props.shouldSendToStreamlit) {\n      stCanvas.loadFromJSON(debouncedStateToSend, () => {\n        sendDataToStreamlit(stCanvas, props.selectedRect)\n      })\n    }\n\n\n  }, [stCanvas, props.shouldSendToStreamlit, props.selectedRect, debouncedStateToSend])\n\n  return (\n    <canvas\n      id=\"canvas-to-streamlit\"\n      width={props.canvasWidth}\n      height={props.canvasHeight}\n    />\n  )\n}\n\nexport default UpdateStreamlit\n","import React, {\n  createContext,\n  useReducer,\n  useContext,\n  useCallback,\n} from \"react\"\nimport { isEmpty, isEqual } from \"lodash\"\n\nconst HISTORY_MAX_COUNT = 100\n\ninterface CanvasHistory {\n  undoStack: Object[] // store previous canvas states\n  redoStack: Object[] // store undone canvas states\n}\n\ninterface CanvasAction {\n  shouldReloadCanvas: boolean // reload currentState into app canvas, on undo/redo\n  forceSendToStreamlit: boolean // send currentState back to Streamlit\n}\n\nconst NO_ACTION: CanvasAction = {\n  shouldReloadCanvas: false,\n  forceSendToStreamlit: false,\n}\n\nconst RELOAD_CANVAS: CanvasAction = {\n  shouldReloadCanvas: true,\n  forceSendToStreamlit: false,\n}\n\nconst SEND_TO_STREAMLIT: CanvasAction = {\n  shouldReloadCanvas: false,\n  forceSendToStreamlit: true,\n}\n\nconst RELOAD_AND_SEND_TO_STREAMLIT: CanvasAction = {\n  shouldReloadCanvas: true,\n  forceSendToStreamlit: true,\n}\n\ninterface CanvasState {\n  history: CanvasHistory\n  action: CanvasAction\n  initialState: Object // first currentState for app\n  currentState: Object // current canvas state as canvas.toJSON()\n}\n\ninterface Action {\n  type: \"save\" | \"undo\" | \"redo\" | \"reset\" | \"forceSendToStreamlit\"\n  state?: Object\n}\n\n/**\n * Reducer takes 5 actions: save, undo, redo, reset, forceSendToStreamlit\n *\n * On reset, clear everything, set initial and current state to cleared canvas\n *\n * On save:\n * - First, if there is no initial state, set it to current\n *   Since we don't reset history on component initialization\n *   As backgroundColor/image are applied after component init\n *   and wouldn't be stored in initial state\n * - If the sent state is same as current state, then nothing has changed so don't save\n * - Clear redo stack\n * - Push current state to undo stack, delete oldest if necessary\n * - Set new current state\n *\n * On undo:\n * - Push state to redoStack if it's not the initial\n * - Pop state from undoStack into current state\n *\n * On redo:\n * - Pop state from redoStack into current state\n *\n * For undo/redo/reset, set shouldReloadCanvas to inject currentState into user facing canvas\n */\nconst canvasStateReducer = (\n  state: CanvasState,\n  action: Action\n): CanvasState => {\n  switch (action.type) {\n    case \"save\":\n      if (!action.state) throw new Error(\"No action state to save\")\n      else if (isEmpty(state.currentState)) {\n        return {\n          history: {\n            undoStack: [],\n            redoStack: [],\n          },\n          action: { ...NO_ACTION },\n          initialState: action.state,\n          currentState: action.state,\n        }\n      } else if (isEqual(action.state, state.currentState))\n        return {\n          history: { ...state.history },\n          action: { ...NO_ACTION },\n          initialState: state.initialState,\n          currentState: state.currentState,\n        }\n      else {\n        const undoOverHistoryMaxCount =\n          state.history.undoStack.length >= HISTORY_MAX_COUNT\n        return {\n          history: {\n            undoStack: [\n              ...state.history.undoStack.slice(undoOverHistoryMaxCount ? 1 : 0),\n              state.currentState,\n            ],\n            redoStack: [],\n          },\n          action: { ...NO_ACTION },\n          initialState:\n            state.initialState == null\n              ? state.currentState\n              : state.initialState,\n          currentState: action.state,\n        }\n      }\n    case \"undo\":\n      if (\n        isEmpty(state.currentState) ||\n        isEqual(state.initialState, state.currentState)\n      ) {\n        return {\n          history: { ...state.history },\n          action: { ...NO_ACTION },\n          initialState: state.initialState,\n          currentState: state.currentState,\n        }\n      } else {\n        const isUndoEmpty = state.history.undoStack.length === 0\n        return {\n          history: {\n            undoStack: state.history.undoStack.slice(0, -1),\n            redoStack: [...state.history.redoStack, state.currentState],\n          },\n          action: { ...RELOAD_CANVAS },\n          initialState: state.initialState,\n          currentState: isUndoEmpty\n            ? state.currentState\n            : state.history.undoStack[state.history.undoStack.length - 1],\n        }\n      }\n    case \"redo\":\n      if (state.history.redoStack.length > 0) {\n        // TODO: test currentState empty too ?\n        return {\n          history: {\n            undoStack: [...state.history.undoStack, state.currentState],\n            redoStack: state.history.redoStack.slice(0, -1),\n          },\n          action: { ...RELOAD_CANVAS },\n          initialState: state.initialState,\n          currentState:\n            state.history.redoStack[state.history.redoStack.length - 1],\n        }\n      } else {\n        return {\n          history: { ...state.history },\n          action: { ...NO_ACTION },\n          initialState: state.initialState,\n          currentState: state.currentState,\n        }\n      }\n    case \"reset\":\n      if (!action.state) throw new Error(\"No action state to store in reset\")\n      return {\n        history: {\n          undoStack: [],\n          redoStack: [],\n        },\n        action: { ...RELOAD_AND_SEND_TO_STREAMLIT },\n        initialState: action.state,\n        currentState: action.state,\n      }\n    case \"forceSendToStreamlit\":\n      return {\n        history: { ...state.history },\n        action: { ...SEND_TO_STREAMLIT },\n        initialState: state.initialState,\n        currentState: state.currentState,\n      }\n    default:\n      throw new Error(\"TS should protect from this\")\n  }\n}\n\nconst initialState: CanvasState = {\n  history: {\n    undoStack: [],\n    redoStack: [],\n  },\n  action: {\n    forceSendToStreamlit: false,\n    shouldReloadCanvas: false,\n  },\n  initialState: {},\n  currentState: {},\n}\n\ninterface CanvasStateContextProps {\n  canvasState: CanvasState\n  saveState: (state: Object) => void\n  undo: () => void\n  redo: () => void\n  forceStreamlitUpdate: () => void\n  canUndo: boolean\n  canRedo: boolean\n  resetState: (state: Object) => void\n}\n\nconst CanvasStateContext = createContext<CanvasStateContextProps>(\n  {} as CanvasStateContextProps\n)\n\nexport const CanvasStateProvider = ({\n  children,\n}: React.PropsWithChildren<{}>) => {\n  const [canvasState, dispatch] = useReducer(canvasStateReducer, initialState)\n\n  // Setup our callback functions\n  // We memoize with useCallback to prevent unnecessary re-renders\n  const saveState = useCallback(\n    (state) => dispatch({ type: \"save\", state: state }),\n    [dispatch]\n  )\n  const undo = useCallback(() => dispatch({ type: \"undo\" }), [dispatch])\n  const redo = useCallback(() => dispatch({ type: \"redo\" }), [dispatch])\n  const forceStreamlitUpdate = useCallback(\n    () => dispatch({ type: \"forceSendToStreamlit\" }),\n    [dispatch]\n  )\n  const resetState = useCallback(\n    (state) => dispatch({ type: \"reset\", state: state }),\n    [dispatch]\n  )\n\n  const canUndo = canvasState.history.undoStack.length !== 0\n  const canRedo = canvasState.history.redoStack.length !== 0\n\n  return (\n    <CanvasStateContext.Provider\n      value={{\n        canvasState,\n        saveState,\n        undo,\n        redo,\n        canUndo,\n        canRedo,\n        forceStreamlitUpdate,\n        resetState,\n      }}\n    >\n      {children}\n    </CanvasStateContext.Provider>\n  )\n}\n\n/**\n * Hook to get data out of context\n */\nexport const useCanvasState = () => {\n  return useContext(CanvasStateContext)\n}\n","import { fabric } from \"fabric\"\n\nexport interface ConfigureCanvasProps {\n    fillColor: string\n    strokeWidth: number\n    strokeColor: string\n    displayRadius: number\n}\n\n/**\n * Base class for any fabric tool that configures and draws on canvas\n */\nabstract class FabricTool {\n  protected _canvas: fabric.Canvas\n\n  /**\n   * Pass Fabric canvas by reference so tools can configure it\n   */\n  constructor(canvas: fabric.Canvas) {\n    this._canvas = canvas\n  }\n\n  /**\n   * Configure canvas and return a callback to clean eventListeners\n   * @param args\n   */\n  abstract configureCanvas(args: ConfigureCanvasProps): () => void\n}\n\nexport default FabricTool\n","import CircleTool from \"./circle\"\nimport FabricTool from \"./fabrictool\"\nimport FreedrawTool from \"./freedraw\"\nimport LineTool from \"./line\"\nimport PolygonTool from \"./polygon\"\nimport RectTool from \"./rect\"\nimport TransformTool from \"./transform\"\nimport PointTool from \"./point\"\n\n// TODO: Should make TS happy on the Map of selectedTool --> FabricTool\nconst tools: any = {\n  circle: CircleTool,\n  freedraw: FreedrawTool,\n  line: LineTool,\n  polygon: PolygonTool,\n  rect: RectTool,\n  transform: TransformTool,\n  point: PointTool\n}\n\nexport { tools, FabricTool }\n","import { fabric } from \"fabric\"\nimport FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\n\nclass CircleTool extends FabricTool {\n  isMouseDown: boolean = false\n  fillColor: string = \"#ffffff\"\n  strokeWidth: number = 10\n  strokeColor: string = \"#ffffff\"\n  currentCircle: fabric.Circle = new fabric.Circle()\n  currentStartX: number = 0\n  currentStartY: number = 0\n  _minRadius: number = 10\n\n  configureCanvas({\n    strokeWidth,\n    strokeColor,\n    fillColor,\n  }: ConfigureCanvasProps): () => void {\n    this._canvas.isDrawingMode = false\n    this._canvas.selection = false\n    this._canvas.forEachObject((o) => (o.selectable = o.evented = false))\n\n    this.strokeWidth = strokeWidth\n    this.strokeColor = strokeColor\n    this.fillColor = fillColor\n    this._minRadius = strokeWidth\n\n    this._canvas.on(\"mouse:down\", (e: any) => this.onMouseDown(e))\n    this._canvas.on(\"mouse:move\", (e: any) => this.onMouseMove(e))\n    this._canvas.on(\"mouse:up\", (e: any) => this.onMouseUp(e))\n    this._canvas.on(\"mouse:out\", (e: any) => this.onMouseOut(e))\n    return () => {\n      this._canvas.off(\"mouse:down\")\n      this._canvas.off(\"mouse:move\")\n      this._canvas.off(\"mouse:up\")\n      this._canvas.off(\"mouse:out\")\n    }\n  }\n\n  onMouseDown(o: any) {\n    let canvas = this._canvas\n    let _clicked = o.e[\"button\"]\n    this.isMouseDown = true\n    let pointer = canvas.getPointer(o.e)\n    this.currentStartX = pointer.x\n    this.currentStartY = pointer.y\n    this.currentCircle = new fabric.Circle({\n      left: this.currentStartX,\n      top: this.currentStartY,\n      originX: \"left\",\n      originY: \"center\",\n      strokeWidth: this.strokeWidth,\n      stroke: this.strokeColor,\n      fill: this.fillColor,\n      selectable: false,\n      evented: false,\n      radius: this._minRadius,\n    })\n    if (_clicked === 0) {\n      canvas.add(this.currentCircle)\n    }\n  }\n\n  onMouseMove(o: any) {\n    if (!this.isMouseDown) return\n    let canvas = this._canvas\n    let pointer = canvas.getPointer(o.e)\n    let _radius =\n      this.linearDistance(\n        { x: this.currentStartX, y: this.currentStartY },\n        { x: pointer.x, y: pointer.y }\n      ) / 2\n    this.currentCircle.set({\n      radius: Math.max(_radius, this._minRadius),\n      angle:\n        (Math.atan2(\n          pointer.y - this.currentStartY,\n          pointer.x - this.currentStartX\n        ) *\n          180) /\n        Math.PI,\n    })\n    this.currentCircle.setCoords()\n    canvas.renderAll()\n  }\n\n  onMouseUp(o: any) {\n    this.isMouseDown = false\n  }\n\n  onMouseOut(o: any) {\n    this.isMouseDown = false\n  }\n\n  /**\n   * Calculate the distance of two x,y points\n   *\n   * @param point1 an object with x,y attributes representing the start point\n   * @param point2 an object with x,y attributes representing the end point\n   *\n   * @returns {number}\n   */\n  linearDistance = (point1: any, point2: any) => {\n    let xs = point2.x - point1.x\n    let ys = point2.y - point1.y\n    return Math.sqrt(xs * xs + ys * ys)\n  }\n}\n\nexport default CircleTool\n","import FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\n\nclass FreedrawTool extends FabricTool {\n  configureCanvas({\n    strokeWidth,\n    strokeColor,\n  }: ConfigureCanvasProps): () => void {\n    this._canvas.isDrawingMode = true\n    this._canvas.freeDrawingBrush.width = strokeWidth\n    this._canvas.freeDrawingBrush.color = strokeColor\n    return () => {}\n  }\n}\n\nexport default FreedrawTool\n","import { fabric } from \"fabric\"\nimport FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\n\nclass LineTool extends FabricTool {\n  isMouseDown: boolean = false\n  strokeWidth: number = 10\n  strokeColor: string = \"#ffffff\"\n  currentLine: fabric.Line = new fabric.Line()\n\n  configureCanvas({\n    strokeWidth,\n    strokeColor,\n  }: ConfigureCanvasProps): () => void {\n    this._canvas.isDrawingMode = false\n    this._canvas.selection = false\n    this._canvas.forEachObject((o) => (o.selectable = o.evented = false))\n\n    this.strokeWidth = strokeWidth\n    this.strokeColor = strokeColor\n\n    this._canvas.on(\"mouse:down\", (e: any) => this.onMouseDown(e))\n    this._canvas.on(\"mouse:move\", (e: any) => this.onMouseMove(e))\n    this._canvas.on(\"mouse:up\", (e: any) => this.onMouseUp(e))\n    this._canvas.on(\"mouse:out\", (e: any) => this.onMouseOut(e))\n    return () => {\n      this._canvas.off(\"mouse:down\")\n      this._canvas.off(\"mouse:move\")\n      this._canvas.off(\"mouse:up\")\n      this._canvas.off(\"mouse:out\")\n    }\n  }\n\n  onMouseDown(o: any) {\n    let canvas = this._canvas\n    let _clicked = o.e[\"button\"]\n    this.isMouseDown = true\n    var pointer = canvas.getPointer(o.e)\n    var points = [pointer.x, pointer.y, pointer.x, pointer.y]\n    this.currentLine = new fabric.Line(points, {\n      strokeWidth: this.strokeWidth,\n      fill: this.strokeColor,\n      stroke: this.strokeColor,\n      originX: \"center\",\n      originY: \"center\",\n      selectable: false,\n      evented: false,\n    })\n    if (_clicked === 0) {\n      canvas.add(this.currentLine)\n    }\n  }\n\n  onMouseMove(o: any) {\n    if (!this.isMouseDown) return\n    let canvas = this._canvas\n    var pointer = canvas.getPointer(o.e)\n    this.currentLine.set({ x2: pointer.x, y2: pointer.y })\n    this.currentLine.setCoords()\n    canvas.renderAll()\n  }\n\n  onMouseUp(o: any) {\n    this.isMouseDown = false\n    let canvas = this._canvas\n    if (this.currentLine.width === 0 && this.currentLine.height === 0) {\n      canvas.remove(this.currentLine)\n    }\n  }\n\n  onMouseOut(o: any) {\n    this.isMouseDown = false\n  }\n}\n\nexport default LineTool\n","import { fabric } from \"fabric\"\nimport FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\n\nclass PolygonTool extends FabricTool {\n  isMouseDown: boolean = false\n  fillColor: string = \"#ffffff\"\n  strokeWidth: number = 10\n  strokeColor: string = \"#ffffff\"\n  startCircle: fabric.Circle = new fabric.Circle()\n  currentLine: fabric.Line = new fabric.Line()\n  currentPath: fabric.Path = new fabric.Path()\n  _pathString: string = \"M \"\n\n  configureCanvas({\n    strokeWidth,\n    strokeColor,\n    fillColor,\n  }: ConfigureCanvasProps): () => void {\n    this._canvas.isDrawingMode = false\n    this._canvas.selection = false\n    this._canvas.forEachObject((o) => (o.selectable = o.evented = false))\n\n    this.strokeWidth = strokeWidth\n    this.strokeColor = strokeColor\n    this.fillColor = fillColor\n\n    this._canvas.on(\"mouse:down\", (e: any) => this.onMouseDown(e))\n    this._canvas.on(\"mouse:move\", (e: any) => this.onMouseMove(e))\n    this._canvas.on(\"mouse:up\", (e: any) => this.onMouseUp(e))\n    this._canvas.on(\"mouse:out\", (e: any) => this.onMouseOut(e))\n    this._canvas.on(\"mouse:dblclick\", (e: any) => this.onMouseDoubleClick(e))\n    return () => {\n      this._canvas.off(\"mouse:down\")\n      this._canvas.off(\"mouse:move\")\n      this._canvas.off(\"mouse:up\")\n      this._canvas.off(\"mouse:out\")\n      this._canvas.off(\"mouse:dblclick\")\n    }\n  }\n\n  onMouseDown(o: any) {\n    let canvas = this._canvas\n    let _clicked = o.e[\"button\"]\n    let _start = false\n    if (this._pathString === \"M \") {\n      _start = true\n    }\n\n    this.isMouseDown = true\n    var pointer = canvas.getPointer(o.e)\n\n    var points = [pointer.x, pointer.y, pointer.x, pointer.y]\n    canvas.remove(this.currentLine)\n    this.currentLine = new fabric.Line(points, {\n      strokeWidth: this.strokeWidth,\n      fill: this.strokeColor,\n      stroke: this.strokeColor,\n      originX: \"center\",\n      originY: \"center\",\n      selectable: false,\n      evented: false,\n    })\n    if (_clicked === 0) {\n      canvas.add(this.currentLine)\n    }\n\n    if (_start && _clicked === 0) {\n      // Initialize pathString\n      this._pathString += `${pointer.x} ${pointer.y} `\n      this.startCircle = new fabric.Circle({\n        left: pointer.x,\n        top: pointer.y,\n        originX: \"center\",\n        originY: \"center\",\n        strokeWidth: this.strokeWidth,\n        stroke: this.strokeColor,\n        fill: this.strokeColor,\n        selectable: false,\n        evented: false,\n        radius: this.strokeWidth,\n      })\n      canvas.add(this.startCircle)\n\n      _start = false\n    } else {\n      canvas.remove(this.currentPath)\n      if (_clicked === 0) {\n        // Update pathString\n        this._pathString += `L ${pointer.x} ${pointer.y} `\n      }\n      if (_clicked === 2) {\n        // Close pathString\n        this._pathString += \"z\"\n        canvas.remove(this.startCircle)\n      }\n    }\n    this.currentPath = new fabric.Path(this._pathString, {\n      strokeWidth: this.strokeWidth,\n      fill: this.fillColor,\n      stroke: this.strokeColor,\n      originX: \"center\",\n      originY: \"center\",\n      selectable: false,\n      evented: false,\n    })\n    if (this.currentPath.width !== 0 && this.currentPath.height !== 0) {\n      canvas.add(this.currentPath)\n    }\n    if (_clicked === 2) {\n      this._pathString = \"M \"\n    }\n  }\n\n  onMouseMove(o: any) {\n    if (!this.isMouseDown) return\n    let canvas = this._canvas\n    var pointer = canvas.getPointer(o.e)\n    this.currentLine.set({ x2: pointer.x, y2: pointer.y })\n    this.currentLine.setCoords()\n    canvas.renderAll()\n  }\n\n  onMouseUp(o: any) {\n    this.isMouseDown = true\n  }\n\n  onMouseOut(o: any) {\n    this.isMouseDown = false\n  }\n\n  onMouseDoubleClick(o: any) {\n    let canvas = this._canvas\n    // Double click adds two more points at the end, so we have to move back twice more...\n    for (let i = 0; i < 3; i++) {\n      let _last_pt_idx = this._pathString.lastIndexOf(\"L\")\n      if (_last_pt_idx === -1) {\n        this._pathString = \"M \"\n        canvas.remove(this.startCircle)\n      } else {\n        this._pathString = this._pathString.slice(0, _last_pt_idx)\n      }\n    }\n\n    canvas.remove(this.currentLine)\n    canvas.remove(this.currentPath)\n    this.currentPath = new fabric.Path(this._pathString, {\n      strokeWidth: this.strokeWidth,\n      fill: this.fillColor,\n      stroke: this.strokeColor,\n      originX: \"center\",\n      originY: \"center\",\n      selectable: false,\n      evented: false,\n    })\n    canvas.add(this.currentPath)\n  }\n}\nexport default PolygonTool\n","import { fabric } from \"fabric\"\nimport FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\n\nclass RectTool extends FabricTool {\n  isMouseDown: boolean = false\n  fillColor: string = \"#ffffff\"\n  strokeWidth: number = 10\n  strokeColor: string = \"#ffffff\"\n  currentRect: fabric.Rect = new fabric.Rect()\n  currentStartX: number = 0\n  currentStartY: number = 0\n  _minLength: number = 10\n\n  configureCanvas({\n    strokeWidth,\n    strokeColor,\n    fillColor,\n  }: ConfigureCanvasProps): () => void {\n    this._canvas.isDrawingMode = false\n    this._canvas.selection = false\n    this._canvas.forEachObject((o) => (o.selectable = o.evented = false))\n\n    this.strokeWidth = strokeWidth\n    this.strokeColor = strokeColor\n    this.fillColor = fillColor\n    this._minLength = strokeWidth\n\n    this._canvas.on(\"mouse:down\", (e: any) => this.onMouseDown(e))\n    this._canvas.on(\"mouse:move\", (e: any) => this.onMouseMove(e))\n    this._canvas.on(\"mouse:up\", (e: any) => this.onMouseUp(e))\n    this._canvas.on(\"mouse:out\", (e: any) => this.onMouseOut(e))\n    return () => {\n      this._canvas.off(\"mouse:down\")\n      this._canvas.off(\"mouse:move\")\n      this._canvas.off(\"mouse:up\")\n      this._canvas.off(\"mouse:out\")\n    }\n  }\n\n  onMouseDown(o: any) {\n    let canvas = this._canvas\n    let _clicked = o.e[\"button\"]\n    this.isMouseDown = true\n    let pointer = canvas.getPointer(o.e)\n    this.currentStartX = pointer.x\n    this.currentStartY = pointer.y\n    this.currentRect = new fabric.Rect({\n      left: this.currentStartX,\n      top: this.currentStartY,\n      originX: \"left\",\n      originY: \"top\",\n      width: this._minLength,\n      height: this._minLength,\n      stroke: this.strokeColor,\n      strokeWidth: this.strokeWidth,\n      fill: this.fillColor,\n      transparentCorners: false,\n      selectable: false,\n      evented: false,\n      strokeUniform: true,\n      noScaleCache: false,\n      angle: 0,\n    })\n    if (_clicked === 0) {\n      canvas.add(this.currentRect)\n    }\n  }\n\n  onMouseMove(o: any) {\n    if (!this.isMouseDown) return\n    let canvas = this._canvas\n    let pointer = canvas.getPointer(o.e)\n    if (this.currentStartX > pointer.x) {\n      this.currentRect.set({ left: Math.abs(pointer.x) })\n    }\n    if (this.currentStartY > pointer.y) {\n      this.currentRect.set({ top: Math.abs(pointer.y) })\n    }\n    let _width = Math.abs(this.currentStartX - pointer.x)\n    let _height = Math.abs(this.currentStartY - pointer.y)\n    this.currentRect.set({\n      width: Math.max(_width, this._minLength * 2),\n      height: Math.max(_height, this._minLength * 2),\n    })\n    this.currentRect.setCoords()\n    canvas.renderAll()\n  }\n\n  onMouseUp(o: any) {\n    this.isMouseDown = false\n  }\n\n  onMouseOut(o: any) {\n    this.isMouseDown = false\n  }\n}\n\nexport default RectTool\n","import FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\n\nclass TransformTool extends FabricTool {\n  configureCanvas(args: ConfigureCanvasProps): () => void {\n    let canvas = this._canvas\n    canvas.isDrawingMode = false\n    canvas.selection = true\n    canvas.forEachObject((o) => (o.selectable = o.evented = true))\n\n    // instead of looking for target of double click,\n    // assume double click on object clears the selected object\n    const handleDoubleClick = () => {\n      canvas.remove(canvas.getActiveObject())\n    }\n\n    canvas.on(\"mouse:dblclick\", handleDoubleClick)\n    return () => {\n      canvas.off(\"mouse:dblclick\", handleDoubleClick)\n    }\n  }\n}\n\nexport default TransformTool\n","import { fabric } from \"fabric\"\nimport FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\n\nclass PointTool extends FabricTool {\n  isMouseDown: boolean = false\n  fillColor: string = \"#ffffff\"\n  strokeWidth: number = 10\n  strokeColor: string = \"#ffffff\"\n  currentCircle: fabric.Circle = new fabric.Circle()\n  currentStartX: number = 0\n  currentStartY: number = 0\n  displayRadius: number = 1\n\n  configureCanvas({\n    strokeWidth,\n    strokeColor,\n    fillColor,\n    displayRadius\n  }: ConfigureCanvasProps): () => void {\n    this._canvas.isDrawingMode = false\n    this._canvas.selection = false\n    this._canvas.forEachObject((o) => (o.selectable = o.evented = false))\n\n    this.strokeWidth = strokeWidth\n    this.strokeColor = strokeColor\n    this.fillColor = fillColor\n    this.displayRadius = displayRadius\n\n    this._canvas.on(\"mouse:down\", (e: any) => this.onMouseDown(e))\n    this._canvas.on(\"mouse:move\", (e: any) => this.onMouseMove(e))\n    this._canvas.on(\"mouse:up\", (e: any) => this.onMouseUp(e))\n    this._canvas.on(\"mouse:out\", (e: any) => this.onMouseOut(e))\n    return () => {\n      this._canvas.off(\"mouse:down\")\n      this._canvas.off(\"mouse:move\")\n      this._canvas.off(\"mouse:up\")\n      this._canvas.off(\"mouse:out\")\n    }\n  }\n\n  onMouseDown(o: any) {\n    let canvas = this._canvas\n    let _clicked = o.e[\"button\"]\n    this.isMouseDown = true\n    let pointer = canvas.getPointer(o.e)\n    this.currentStartX = pointer.x - (this.displayRadius + this.strokeWidth / 2.)\n    this.currentStartY = pointer.y //- (this._minRadius + this.strokeWidth)\n    this.currentCircle = new fabric.Circle({\n      left: this.currentStartX,\n      top: this.currentStartY,\n      originX: \"left\",\n      originY: \"center\",\n      strokeWidth: this.strokeWidth,\n      stroke: this.strokeColor,\n      fill: this.fillColor,\n      selectable: false,\n      evented: false,\n      radius: this.displayRadius,\n    })\n    if (_clicked === 0) {\n      canvas.add(this.currentCircle)\n    }\n  }\n\n  onMouseMove(o: any) {\n    if (!this.isMouseDown) return\n    let canvas = this._canvas\n    this.currentCircle.setCoords()\n    canvas.renderAll()\n  }\n\n  onMouseUp(o: any) {\n    this.isMouseDown = false\n  }\n\n  onMouseOut(o: any) {\n    this.isMouseDown = false\n  }\n\n}\n\nexport default PointTool\n","import React, {useEffect, useState} from \"react\"\nimport {\n    ComponentProps,\n    Streamlit,\n    withStreamlitConnection,\n} from \"streamlit-component-lib\"\nimport {fabric} from \"fabric\"\nimport {isEqual} from \"lodash\"\n\nimport CanvasToolbar from \"./components/CanvasToolbar\"\nimport UpdateStreamlit from \"./components/UpdateStreamlit\"\n\nimport {useCanvasState} from \"./DrawableCanvasState\"\nimport {tools, FabricTool} from \"./lib\"\n\n/**\n * Arguments Streamlit receives from the Python side\n */\nexport interface PythonArgs {\n    fillColor: string\n    strokeWidth: number\n    strokeColor: string\n    backgroundColor: string\n    backgroundImageURL: string\n    realtimeUpdateStreamlit: boolean\n    canvasWidth: number\n    canvasHeight: number\n    drawingMode: string\n    initialDrawing: Object\n    displayToolbar: boolean\n    displayRadius: number\n}\n\n/**\n * Define logic for the canvas area\n */\nconst DrawableCanvas = ({args}: ComponentProps) => {\n    const {\n        canvasWidth,\n        canvasHeight,\n        backgroundColor,\n        backgroundImageURL,\n        realtimeUpdateStreamlit,\n        drawingMode,\n        fillColor,\n        strokeWidth,\n        strokeColor,\n        displayRadius,\n        initialDrawing,\n        displayToolbar,\n    }: PythonArgs = args\n\n    /**\n     * State initialization\n     */\n    const [canvas, setCanvas] = useState(new fabric.Canvas(\"\"))\n    canvas.stopContextMenu = true\n    canvas.fireRightClick = true\n\n    const [selectedRect, setSelectedRect] = useState(-1)\n\n    const [backgroundCanvas, setBackgroundCanvas] = useState(\n        new fabric.StaticCanvas(\"\")\n    )\n    const {\n        canvasState: {\n            action: {shouldReloadCanvas, forceSendToStreamlit},\n            currentState,\n            initialState,\n        },\n        saveState,\n        undo,\n        redo,\n        canUndo,\n        canRedo,\n        forceStreamlitUpdate,\n        resetState,\n    } = useCanvasState()\n\n    /**\n     * Initialize canvases on component mount\n     * NB: Remount component by changing its key instead of defining deps\n     */\n    useEffect(() => {\n        const c = new fabric.Canvas(\"canvas\", {\n            enableRetinaScaling: false,\n        })\n        const imgC = new fabric.StaticCanvas(\"backgroundimage-canvas\", {\n            enableRetinaScaling: false,\n        })\n        setCanvas(c)\n        setBackgroundCanvas(imgC)\n        Streamlit.setFrameHeight()\n    }, [])\n\n    /**\n     * Load user drawing into canvas\n     * Python-side is in charge of initializing drawing with background color if none provided\n     */\n    useEffect(() => {\n        if (!isEqual(initialState, initialDrawing)) {\n            canvas.loadFromJSON(initialDrawing, () => {\n                canvas.renderAll()\n                resetState(initialDrawing)\n            })\n        }\n    }, [canvas, initialDrawing, initialState, resetState])\n\n    /**\n     * Update background image\n     */\n    useEffect(() => {\n        if (backgroundImageURL) {\n            var bgImage = new Image();\n            bgImage.onload = function () {\n                backgroundCanvas.getContext().drawImage(bgImage, 0, 0);\n            };\n            const params = new URLSearchParams(window.location.search);\n            const baseUrl = params.get('streamlitUrl')\n            bgImage.src = baseUrl + backgroundImageURL;\n        }\n    }, [\n        canvas,\n        backgroundCanvas,\n        canvasHeight,\n        canvasWidth,\n        backgroundColor,\n        backgroundImageURL,\n        saveState,\n    ])\n\n    /**\n     * If state changed from undo/redo/reset, update user-facing canvas\n     */\n    useEffect(() => {\n        if (shouldReloadCanvas) {\n            canvas.loadFromJSON(currentState, () => {\n            })\n        }\n    }, [canvas, shouldReloadCanvas, currentState])\n\n    /**\n     * Update canvas with selected tool\n     * PS: add initialDrawing in dependency so user drawing update reinits tool\n     */\n    useEffect(() => {\n        // Update canvas events with selected tool\n        const selectedTool = new tools[drawingMode](canvas) as FabricTool\n        const cleanupToolEvents = selectedTool.configureCanvas({\n            fillColor: fillColor,\n            strokeWidth: strokeWidth,\n            strokeColor: strokeColor,\n            displayRadius: displayRadius,\n        })\n\n        canvas.on(\"mouse:up\", (e: any) => {\n            saveState(canvas.toJSON())\n            if (e[\"button\"] === 3) {\n                forceStreamlitUpdate()\n            }\n        })\n\n        canvas.on(\"mouse:dblclick\", () => {\n            saveState(canvas.toJSON())\n        })\n\n        canvas.on('mouse:down', (options) => {\n            if (options.target) {\n                if (options.target.type === 'rect') {\n                    const selectObject = canvas.getActiveObject()\n                    const selectIndex = canvas.getObjects().indexOf(selectObject)\n\n                    selectObject.selectionBackgroundColor = 'rgba(63,245,39,0.5)'\n\n                    setSelectedRect(selectIndex)\n\n                    const data = canvas\n                        .getContext()\n                        .canvas.toDataURL()\n                    Streamlit.setComponentValue({\n                        data: data,\n                        width: canvas.getWidth(),\n                        height: canvas.getHeight(),\n                        raw: canvas.toObject(),\n                        selectIndex: selectIndex\n                    })\n                }\n            } else {\n                setSelectedRect(-1)\n            }\n        });\n\n        // Cleanup tool + send data to Streamlit events\n        return () => {\n            cleanupToolEvents()\n            canvas.off(\"mouse:up\")\n            canvas.off(\"mouse:dblclick\")\n            canvas.off(\"mouse:down\")\n        }\n    }, [\n        canvas,\n        strokeWidth,\n        strokeColor,\n        displayRadius,\n        fillColor,\n        drawingMode,\n        initialDrawing,\n        saveState,\n        forceStreamlitUpdate,\n    ])\n\n    /**\n     * Render canvas w/ toolbar\n     */\n    return (\n        <div style={{position: \"relative\"}}>\n            <div\n                style={{\n                    position: \"absolute\",\n                    top: 0,\n                    left: 0,\n                    zIndex: -10,\n                    visibility: \"hidden\",\n                }}\n            >\n                <UpdateStreamlit\n                    canvasHeight={canvasHeight}\n                    canvasWidth={canvasWidth}\n                    shouldSendToStreamlit={\n                        realtimeUpdateStreamlit || forceSendToStreamlit\n                    }\n                    stateToSendToStreamlit={currentState}\n                    selectedRect={selectedRect}\n                />\n            </div>\n            <div\n                style={{\n                    position: \"absolute\",\n                    top: 0,\n                    left: 0,\n                    zIndex: 0,\n                }}\n            >\n                <canvas\n                    id=\"backgroundimage-canvas\"\n                    width={canvasWidth}\n                    height={canvasHeight}\n                />\n            </div>\n            <div\n                style={{\n                    position: \"absolute\",\n                    top: 0,\n                    left: 0,\n                    zIndex: 10,\n                }}\n            >\n                <canvas\n                    id=\"canvas\"\n                    width={canvasWidth}\n                    height={canvasHeight}\n                    style={{border: \"lightgrey 1px solid\"}}\n                />\n            </div>\n            {displayToolbar && (\n                <CanvasToolbar\n                    topPosition={canvasHeight}\n                    leftPosition={canvasWidth}\n                    canUndo={canUndo}\n                    canRedo={canRedo}\n                    downloadCallback={forceStreamlitUpdate}\n                    undoCallback={undo}\n                    redoCallback={redo}\n                    resetCallback={() => {\n                        resetState(initialState)\n                    }}\n                />\n            )}\n        </div>\n    )\n}\n\nexport default withStreamlitConnection(DrawableCanvas)\n","import React from \"react\"\nimport ReactDOM from \"react-dom\"\nimport DrawableCanvas from \"./DrawableCanvas\"\nimport { CanvasStateProvider } from \"./DrawableCanvasState\"\n\nimport \"./index.css\"\n\nReactDOM.render(\n  <React.StrictMode>\n    <CanvasStateProvider>\n      <DrawableCanvas />\n    </CanvasStateProvider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n)\n"],"sourceRoot":""}